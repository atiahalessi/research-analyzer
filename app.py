import streamlit as st
import google.generativeai as genai
import pandas as pd
from io import BytesIO

# ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
st.set_page_config(page_title="ูุญูู ุงูุฏุฑุงุณุงุช ุงูุนูููุฉ", layout="wide")

st.title("๐ฌ ุฃุฏุงุฉ ุชุญููู ุงูุฏุฑุงุณุงุช ุงูุนูููุฉ ูุฅูุดุงุก ุงููุตูููุงุช")
st.write("ูู ุจุฑูุน ูููุงุช PDF ููุฏุฑุงุณุงุช ูุณูููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงููุทููุจุฉ.")

# ุฅุฏุฎุงู ููุชุงุญ API ุงูุฎุงุต ุจู Google AI Studio
api_key = st.sidebar.text_input("ุฃุฏุฎู ููุชุงุญ Gemini API ุงูุฎุงุต ุจู:", type="password")

if api_key:
    genai.configure(api_key=api_key)
    model = genai.GenerativeModel('gemini-1.5-pro')

    # ุฑูุน ุงููููุงุช
    uploaded_files = st.file_uploader("ุงุฎุชุฑ ูููุงุช ุงูุฏุฑุงุณุงุช (PDF)", type="pdf", accept_multiple_files=True)

    if uploaded_files and st.button("ุจุฏุก ุงูุชุญููู"):
        all_data = []
        
        with st.spinner("ุฌุงุฑู ุชุญููู ุงูุฏุฑุงุณุงุช... ูุฏ ูุณุชุบุฑู ุฐูู ุฏูููุฉ ุญุณุจ ุญุฌู ุงููููุงุช"):
            for uploaded_file in uploaded_files:
                # ูุฑุงุกุฉ ุงูููู ูุฑูุนู ูู Gemini
                # ููุงุญุธุฉ: Gemini 1.5 Pro ูุฏุนู ุฑูุน ุงููููุงุช ูุจุงุดุฑุฉ
                try:
                    # ุชุญููู ุงูููู ุงููุฑููุน ุฅูู ุจุงูุชุงุช ููุชุญููู
                    file_data = uploaded_file.read()
                    
                    prompt = f"""
                    ุญูู ุงูุฏุฑุงุณุฉ ุงููุฑููุฉ ูุงุณุชุฎุฑุฌ ุงูุจูุงูุงุช ุงูุชุงููุฉ ุจุฏูุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ:
                    (ุงุณู ุงูุฏุฑุงุณุฉุ ููุงู ุงููุดุฑุ ุชุงุฑูุฎ ุงููุดุฑุ ูุดููุฉ ุงูุฏุฑุงุณุฉุ ุฃูุฏุงู ุงูุฏุฑุงุณุฉุ ุฃุณุฆูุฉ ุงูุฏุฑุงุณุฉุ ุญุฏูุฏ ุงูุฏุฑุงุณุฉ ุงูุฒูุงููุฉุ ูููุฌ ุงูุฏุฑุงุณุฉุ ุฃุฏุงุฉ ุงูุฏุฑุงุณุฉุ ุญุฏูุฏ ุงูุฏุฑุงุณุฉ ุงูููุงููุฉุ ุฃูู ุงููุชุงุฆุฌุ ุงูุชูุตูุงุชุ ุงูุงูุชุฑุงุญุงุช).
                    ูู ุจุตูุงุบุฉ ุงููุฎุฑุฌุงุช ููุงุฆูุฉ ููุตููุฉ ุจู | (Pipe) ูุณูููุฉ ูุนุงูุฌุชูุง ุจุฑูุฌูุงู.
                    """
                    
                    response = model.generate_content([
                        prompt,
                        {'mime_type': 'application/pdf', 'data': file_data}
                    ])
                    
                    # ูุนุงูุฌุฉ ุงููุต ุงููุงุชุฌ (ุชุจุณูุทุงู ุณูุนุฑุถ ุงููุตุ ููููู ุชุญูููู ูุฌุฏูู ูุงุญูุงู)
                    st.subheader(f"ุชุญููู: {uploaded_file.name}")
                    st.write(response.text)
                    
                except Exception as e:
                    st.error(f"ุญุฏุซ ุฎุทุฃ ูู ุชุญููู {uploaded_file.name}: {e}")

        st.success("ุชู ุงูุงูุชูุงุก ูู ุงูุชุญููู!")
        st.info("ููุงุญุธุฉ: ููููู ูุณุฎ ุงููุฎุฑุฌุงุช ูุจุงุดุฑุฉ ุฅูู ููู Word ุฃู Excel.")
else:
    st.warning("ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ API ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก.")
